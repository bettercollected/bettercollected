(function(d,f){typeof exports=="object"&&typeof module<"u"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(d=typeof globalThis<"u"?globalThis:d||self,f(d.ReduxUndo={}))})(this,function(d){"use strict";const f={UNDO:"@@redux-undo/UNDO",REDO:"@@redux-undo/REDO",JUMP_TO_FUTURE:"@@redux-undo/JUMP_TO_FUTURE",JUMP_TO_PAST:"@@redux-undo/JUMP_TO_PAST",JUMP:"@@redux-undo/JUMP",CLEAR_HISTORY:"@@redux-undo/CLEAR_HISTORY"},E={undo(){return{type:f.UNDO}},redo(){return{type:f.REDO}},jumpToFuture(e){return{type:f.JUMP_TO_FUTURE,index:e}},jumpToPast(e){return{type:f.JUMP_TO_PAST,index:e}},jump(e){return{type:f.JUMP,index:e}},clearHistory(){return{type:f.CLEAR_HISTORY}}};function _(e,t=[]){return Array.isArray(e)?e:typeof e=="string"?[e]:t}function R(e){return typeof e.present<"u"&&typeof e.future<"u"&&typeof e.past<"u"&&Array.isArray(e.future)&&Array.isArray(e.past)}function F(e){const t=_(e);return n=>t.indexOf(n.type)>=0}function j(e){const t=_(e);return n=>t.indexOf(n.type)<0}function x(...e){return e.reduce((t,n)=>(s,l,u)=>t(s,l,u)&&n(s,l,u),()=>!0)}function M(e){const t=_(e);return n=>t.indexOf(n.type)>=0?n.type:null}function T(e,t,n,s=null){return{past:e,present:t,future:n,group:s,_latestUnfiltered:t,index:e.length,limit:e.length+n.length+1}}let U,a;const A={prevState:"#9E9E9E",action:"#03A9F4",nextState:"#4CAF50"};function v(){a={header:[],prev:[],action:[],next:[],msgs:[]}}function I(){const{header:e,prev:t,next:n,action:s,msgs:l}=a;console.group?(console.groupCollapsed(...e),console.log(...t),console.log(...s),console.log(...n),console.log(...l),console.groupEnd()):(console.log(...e),console.log(...t),console.log(...s),console.log(...n),console.log(...l))}function O(e,t,n){return[`%c${e}`,`color: ${t}; font-weight: bold`,n]}function J(e,t){v(),U&&(console.group?(a.header=["%credux-undo","font-style: italic","action",e.type],a.action=O("action",A.action,e),a.prev=O("prev history",A.prevState,t)):(a.header=["redux-undo action",e.type],a.action=["action",e],a.prev=["prev history",t]))}function y(e){U&&(console.group?a.next=O("next history",A.nextState,e):a.next=["next history",e],I())}function p(...e){U&&(a.msgs=a.msgs.concat([...e,`
`]))}function b(e){U=e}function P(e,t){const n=T([],e,[]);return t&&(n._latestUnfiltered=null),n}function w(e,t,n,s){const l=e.past.length+1;p("inserting",t),p("new free: ",n-l);const{past:u,_latestUnfiltered:o}=e,c=n&&n<=l,r=u.slice(c?1:0),i=o!=null?[...r,o]:r;return T(i,t,[],s)}function h(e,t){if(t<0||t>=e.future.length)return e;const{past:n,future:s,_latestUnfiltered:l}=e,u=[...n,l,...s.slice(0,t)],o=s[t],c=s.slice(t+1);return T(u,o,c)}function H(e,t){if(t<0||t>=e.past.length)return e;const{past:n,future:s,_latestUnfiltered:l}=e,u=n.slice(0,t),o=[...n.slice(t+1),l,...s],c=n[t];return T(u,c,o)}function S(e,t){return t>0?h(e,t-1):t<0?H(e,e.past.length+t):e}function B(e,t){return t.indexOf(e)>-1?e:!e}function D(e,t={}){b(t.debug);const n={limit:void 0,filter:()=>!0,groupBy:()=>null,undoType:f.UNDO,redoType:f.REDO,jumpToPastType:f.JUMP_TO_PAST,jumpToFutureType:f.JUMP_TO_FUTURE,jumpType:f.JUMP,neverSkipReducer:!1,ignoreInitialState:!1,syncFilter:!1,...t,initTypes:_(t.initTypes,["@@redux-undo/INIT"]),clearHistoryType:_(t.clearHistoryType,[f.CLEAR_HISTORY])},s=n.neverSkipReducer?(u,o,...c)=>({...u,present:e(u.present,o,...c)}):u=>u;let l;return(u=l,o={},...c)=>{J(o,u);let r=u;if(!l)if(p("history is uninitialized"),u===void 0){const m=e(u,{type:"@@redux-undo/CREATE_HISTORY"},...c);return r=P(m,n.ignoreInitialState),p("do not set initialState on probe actions"),y(r),r}else R(u)?(r=l=n.ignoreInitialState?u:T(u.past,u.present,u.future),p("initialHistory initialized: initialState is a history",l)):(r=l=P(u,n.ignoreInitialState),p("initialHistory initialized: initialState is not a history",l));let i;switch(o.type){case void 0:return r;case n.undoType:return i=S(r,-1),p("perform undo"),y(i),s(i,o,...c);case n.redoType:return i=S(r,1),p("perform redo"),y(i),s(i,o,...c);case n.jumpToPastType:return i=H(r,o.index),p(`perform jumpToPast to ${o.index}`),y(i),s(i,o,...c);case n.jumpToFutureType:return i=h(r,o.index),p(`perform jumpToFuture to ${o.index}`),y(i),s(i,o,...c);case n.jumpType:return i=S(r,o.index),p(`perform jump to ${o.index}`),y(i),s(i,o,...c);case B(o.type,n.clearHistoryType):return i=P(r.present,n.ignoreInitialState),p("perform clearHistory"),y(i),s(i,o,...c);default:if(i=e(r.present,o,...c),n.initTypes.some(g=>g===o.type))return p("reset history due to init action"),y(l),l;if(r._latestUnfiltered===i)return r;if(typeof n.filter=="function"&&!n.filter(o,i,r)){const g=T(r.past,i,r.future,r.group);return n.syncFilter||(g._latestUnfiltered=r._latestUnfiltered),p("filter ignored action, not storing it in past"),y(g),g}const m=n.groupBy(o,i,r);if(m!=null&&m===r.group){const g=T(r.past,i,r.future,r.group);return p("groupBy grouped the action with the previous action"),y(g),g}return r=w(r,i,n.limit,m),p("inserted new state into history"),y(r),r}}}d.ActionCreators=E,d.ActionTypes=f,d.combineFilters=x,d.default=D,d.excludeAction=j,d.groupByActionTypes=M,d.includeAction=F,d.isHistory=R,d.newHistory=T,d.parseActions=_,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
